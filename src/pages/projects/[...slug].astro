---
import Layout from "../../layouts/Layout.astro";
import SiteHeader from "../../components/SiteHeader.astro";
import SiteFooter from "../../components/SiteFooter.astro";
import site from "../../data/site.json";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content } = await project.render();
---

<Layout
  title={`${project.data.title} — ${site.name}`}
  description={`${project.data.role} at ${project.data.affiliation}`}
>
  <div class="wrap">
    <SiteHeader />

    <main class="content">
      <a class="back" href="/research">← Research / Projects</a>
      <header class="head">
        <h1>{project.data.title}</h1>
        <p class="sub">{project.data.role} · {project.data.affiliation} · {project.data.period}</p>
      </header>

      <div class="meta">
        <span>Tags: {project.data.tags.join(", ")}</span>
        <span>Key tech: {project.data.key_tech.join(", ")}</span>
      </div>

      {project.data.links && (
        <div class="links">
          {project.data.links.map((link) => (
            <a class="link" href={link.href} target={link.href.startsWith("http") ? "_blank" : undefined}>
              {link.label}
            </a>
          ))}
        </div>
      )}

      <article class="prose">
        <Content />
      </article>
    </main>

    <SiteFooter />
  </div>

  <style>
    .wrap { max-width: var(--max); margin: 0 auto; width: 100%; }
    .content { max-width: 760px; }
    .back { font-family: ui-sans-serif, system-ui; font-size: 14px; color: var(--muted); text-decoration: none; }
    .back:hover { text-decoration: underline; }
    .head { padding-bottom: 18px; border-bottom: 1px solid var(--border); margin-bottom: 18px; }
    h1 { margin: 12px 0 6px; font-size: 34px; line-height: 1.15; letter-spacing: -0.01em; }
    .sub { margin: 0; color: var(--muted); font-family: ui-sans-serif, system-ui; font-size: 14px; }

    .meta {
      display: flex;
      flex-direction: column;
      gap: 6px;
      color: var(--muted);
      font-size: 13px;
      font-family: ui-sans-serif, system-ui;
      margin: 10px 0 16px;
    }
    .links { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 16px; }
    .link {
      border: 1px solid var(--border);
      padding: 4px 10px;
      font-size: 12px;
      font-family: ui-sans-serif, system-ui;
      text-decoration: none;
    }
    .link:hover { border-color: var(--text); }

    .prose :global(p) { margin: 0.9em 0; }
    .prose :global(ul) { padding-left: 18px; }
    .prose :global(a) { text-decoration: underline; text-underline-offset: 3px; }
  </style>
</Layout>
